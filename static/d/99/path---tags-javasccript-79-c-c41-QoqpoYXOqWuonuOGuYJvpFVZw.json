{"data":{"site":{"siteMetadata":{"title":"Growing in the web","author":"Yichaoz"}},"allMarkdownRemark":{"totalCount":3,"edges":[{"node":{"fields":{"slug":"/react-time-slicing/"},"id":"eed85c1d-b218-5768-985a-dbfb66646585","excerpt":"Normally React wants to keep the UI consistent with what you told it to render.\nSo if you renderthen it will have to call render methods and…","html":"<p>Normally React wants to keep the UI consistent with what you told it to render.\nSo if you render</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function Slideshow() {\n  return (\n    &lt;div&gt;\n      &lt;Expensive1 /&gt;\n      &lt;Expensive2 /&gt;\n      &lt;Expensive3 /&gt;\n    &lt;/div&gt;\n  );\n}</code></pre></div>\n<p>then it will have to call render methods and create DOM nodes for the whole trees of Expensive1, Expensive2, and Expensive3, when Slideshow is being mounted.</p>\n<p>However, maybe you’re only showing Expensive1 on the first render, and Expensive2 and Expensive3 are not immediately visible. Like if this is really a side show.</p>\n<p>Today, it’s idiomatic to render just the current node, e.g.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function Slideshow(props) {\n  return (\n    &lt;div&gt;\n      {props.current === 0 &amp;&amp; &lt;Expensive1 /&gt;}\n      {props.current === 1 &amp;&amp; &lt;Expensive2 /&gt;}\n      {props.current === 2 &amp;&amp; &lt;Expensive3 /&gt;}\n    &lt;/div&gt;\n  );\n}</code></pre></div>\n<p>The upside of this is that now your first render of <code class=\"language-text\">&lt;Slideshow current={0} /&gt;</code> only includes Expensive1. However, the downside is that the moment you switch to <code class=\"language-text\">&lt;Slideshow current={1} /&gt;</code>, you will experience jank from creating and rendering the whole Expensive2 tree.</p>\n<p>Ideally what we want to do is to tell React that when we render <code class=\"language-text\">&lt;Slideshow current={0} /&gt;</code>, we want to show Expensive1, but we want to start preparing Expensive2 when the browser is idle. This way it won’t block the initial render or cause jank, but by the time you click “next” Expensive2 might just already be complete, and in this case it’ll just replace the DOM node.</p>\n<p>This is exactly what time slicing which I partially demoed in my talk will allow. Your code might look something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function Slideshow(props) {\n  return (\n    &lt;div&gt;\n      &lt;div hidden={props.current !== 0}&gt;\n        &lt;Expensive1 /&gt;\n      &lt;/div&gt;\n      &lt;div hidden={props.current !== 1}&gt;\n        &lt;Expensive2 /&gt;\n      &lt;/div&gt;\n      &lt;div hidden={props.current !== 2}&gt;\n        &lt;Expensive3 /&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n}</code></pre></div>\n<p>Note that hidden is a real HTML attribute. (It acts similar to display: none.) But it could also serve as a hint to React that the tree inside it doesn’t actually need to be committed immediately — because it’s not visible anyway. Also note: this is not a final API, I’m just explaining what it lets you do.</p>\n<p>So when you render <code class=\"language-text\">&lt;Slideshow current={0} /&gt;</code>, React mounts</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div&gt;\n  &lt;div hidden={false}&gt;\n    &lt;Expensive1 /&gt;\n  &lt;/div&gt;\n  &lt;div hidden={true}&gt;\n    &lt;!-- not ready yet --&gt;\n  &lt;/div&gt;\n  &lt;div hidden={true}&gt;\n    &lt;!-- not ready yet --&gt;\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>and whenever the browser is idle (e.g. when you look at the first slideshow item), it will start working on Expensive2 in small chunks. When it’s ready, it will just append it to the hidden div — which won’t be observable to the user because it’s hidden.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div&gt;\n  &lt;div hidden={false}&gt;\n    &lt;Expensive1 /&gt;\n  &lt;/div&gt;\n  &lt;div hidden={true}&gt;\n    &lt;!-- not visible, but prepared during idle periods and now ready! --&gt;\n    &lt;Expensive2 /&gt;\n  &lt;/div&gt;\n  &lt;div hidden={true}&gt;\n    &lt;!-- not ready yet, but React will start working on it next --&gt;\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>Now if you switch to <code class=\"language-text\">&lt;Slideshow current={1} /&gt;</code>, React doesn’t need to do any extra rendering because it has already “prepared” Expensive2 ahead of time.</p>\n<p>And if you switch too fast, and React hasn’t been able to fully prepare Expensive2 yet, it will just pick it up where it left off but set a much more aggressive deadline since we want to see results within ~150ms.</p>\n<p>I hope this explains it a bit! The crucial part here is time slicing. This optimization wouldn’t make sense if pre-rendering Expensive2 or Expensive3 blocked the thread since in this case it wouldn’t be worth slowing down the interactions while Expensive1 is visible. But thanks to React’s architecture, we can actually start pre-rendering Expensive2 and Expensive3 in small chunks without blocking the thread, and that’s what will enable this optimization.</p>\n<p>Source: <a href=\"https://github.com/oliviertassinari/react-swipeable-views/issues/453#issuecomment-417939459\">github</a></p>","frontmatter":{"title":"React 16 time slicing trick","date":"September 09, 2018"}}},{"node":{"fields":{"slug":"/me/"},"id":"3ecf4274-ae33-5268-ace7-7db201cd2dc7","excerpt":"Hello world !","html":"<p>Hello world !</p>\n<p><img src=\"/uploads/p7.jpg\"></p>","frontmatter":{"title":"Me","date":"August 26, 2018"}}},{"node":{"fields":{"slug":"/why-call-super-or-super-props/"},"id":"ffcd6d3a-a1c5-5505-93c0-b9caa53fcb25","excerpt":"In react world, many time we call  and , I do that and saw in many places, however I’ve never asked myself what does it actually do…eg.So…","html":"<p>In react world, many time we call <code class=\"language-text\">super</code> and <code class=\"language-text\">super(props)</code>, I do that and saw in many places, however I’ve never asked myself what does it actually do…</p>\n<p>eg.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onClickDiv <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">onClickDiv</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">onClickDiv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do stuff</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onClickDiv<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So according to React <a href=\"https://github.com/facebook/react/blob/52752446760dee0bc7232b4146f5a309ac57f065/src/isomorphic/modern/class/ReactComponent.js#L23\">source code</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">    <span class=\"token keyword\">function</span> <span class=\"token function\">ReactComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The only reason is to let you use <code class=\"language-text\">this</code> or <code class=\"language-text\">this.props</code> inside of the constructor, however you could always use <code class=\"language-text\">props</code> from the constructor attribute…\nThere is only one reason when one needs to pass props to super():</p>\n<p> Passing:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n\n         console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// goood</span>\n     <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n<p> Not passing:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n         console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// -> undefined</span>\n\n         <span class=\"token comment\">// Props parameter is still available</span>\n         console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// good</span>\n     <span class=\"token punctuation\">}</span>\n\n     <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token comment\">// No difference outside constructor</span>\n         console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// good</span>\n     <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n<p> Not calling:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n           console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// undefined</span>\n     <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n<p> Source: <a href=\"https://stackoverflow.com/questions/30571875/whats-the-difference-between-super-and-superprops-in-react-when-using-e\">Stackoverflow</a></p>","frontmatter":{"title":"Why call super or super(props)","date":"December 13, 2017"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"tag":"javasccript"}}